<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ - ì½”ì–´ìœ„ë¸Œ ìŠ¤í…Œì´í‚¹</title>
    <script>
      // Firebase Analytics IndexedDB ê²½ê³  í•„í„°ë§
      (function() {
        const originalError = console.error;
        const originalWarn = console.warn;
        
        const filterMessage = (args) => {
          const message = args.map(arg => {
            if (typeof arg === 'string') return arg;
            if (arg && typeof arg.toString === 'function') return arg.toString();
            return JSON.stringify(arg);
          }).join(' ');
          
          return message.includes('Analytics') && 
                 (message.includes('IndexedDB') || 
                  message.includes('indexeddb-unavailable') ||
                  message.includes('analytics/indexeddb-unavailable'));
        };
        
        console.error = function(...args) {
          if (filterMessage(args)) {
            return;
          }
          originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
          if (filterMessage(args)) {
            return;
          }
          originalWarn.apply(console, args);
        };
      })();
    </script>
    <link rel="stylesheet" href="./styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      .admin-container {
        min-height: 100vh;
        padding: 20px;
        background: radial-gradient(circle at top, #1e293b 0, #020617 55%, #000 100%);
      }
      .admin-header {
        background: linear-gradient(135deg, #0052CC 0%, #0047AB 100%);
        padding: 20px 40px;
        margin-bottom: 32px;
        border-radius: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .admin-header h1 {
        color: white;
        font-size: 24px;
        font-weight: 700;
        margin: 0;
      }
      .admin-content {
        max-width: 1400px;
        margin: 0 auto;
      }
      .back-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.2s;
      }
      .back-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="admin-container">
      <div class="admin-content">
        <!-- Admin Header -->
        <div class="admin-header">
          <h1>ğŸ” ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ</h1>
          <a href="/" class="back-btn">â† í™ˆìœ¼ë¡œ</a>
        </div>

        <!-- Admin Dashboard Content -->
        <div id="adminPageContent" style="width: 100%; min-height: 500px;">
          <div class="card glass" style="padding: 40px; text-align: center;">
            <p style="color: #9ca3af; font-size: 16px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Reward Edit Modal -->
    <div class="modal-backdrop" id="rewardEditModal">
      <div class="modal glass" style="max-width: 500px;">
        <div class="modal-header">
          <h2 class="modal-title">ë¦¬ì›Œë“œ ë‚´ì—­ ìˆ˜ì •</h2>
          <button class="modal-close" id="rewardEditCloseBtn">âœ•</button>
        </div>
        <div class="modal-body">
          <div class="form-group" style="margin-bottom: 16px;">
            <label for="editRewardAmount" style="display:block;margin-bottom:8px;font-weight:600;color:var(--text);">ë¦¬ì›Œë“œ ìˆ˜ëŸ‰</label>
            <input
              type="number"
              id="editRewardAmount"
              class="input"
              placeholder="ì˜ˆ: 0.5"
              min="0"
              step="0.0001"
              style="width:100%;"
            />
          </div>
          <div class="form-group" style="margin-bottom: 16px;">
            <label for="editRewardApy" style="display:block;margin-bottom:8px;font-weight:600;color:var(--text);">APY (%)</label>
            <input
              type="number"
              id="editRewardApy"
              class="input"
              placeholder="ì˜ˆ: 8.5"
              min="0"
              step="0.1"
              style="width:100%;"
            />
          </div>
          <div class="form-group" style="margin-bottom: 24px;">
            <label for="editRewardDate" style="display:block;margin-bottom:8px;font-weight:600;color:var(--text);">ë‚ ì§œ</label>
            <input
              type="date"
              id="editRewardDate"
              class="input"
              style="width:100%;"
            />
          </div>
          <div style="display: flex; gap: 12px;">
            <button class="btn-primary" id="rewardUpdateBtn" style="flex: 1; padding: 12px;">ìˆ˜ì •</button>
            <button class="btn-outline" id="rewardDeleteBtn" style="flex: 1; padding: 12px; color: #ef4444; border-color: #ef4444;">ì‚­ì œ</button>
          </div>
          <p id="rewardEditStatusText" style="text-align:center;margin-top:16px;color:var(--text-muted);font-size:14px;"></p>
        </div>
      </div>
    </div>

    <!-- Firebase core (Auth/Firestore) ì´ˆê¸°í™” -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js';
      import {
        getAuth,
        onAuthStateChanged,
      } from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js';
      import {
        getFirestore,
      } from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js';

      const firebaseConfig = {
        apiKey: 'AIzaSyBvb8p8PFmeIh3ZVyWqWk1RQLBZyAUpfk4',
        authDomain: 'j22j22.firebaseapp.com',
        projectId: 'j22j22',
        storageBucket: 'j22j22.firebasestorage.app',
        messagingSenderId: '874202688810',
        appId: '1:874202688810:web:d384f6ea7cc4dcfb0b4253',
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      window.__firebase = {
        app,
        auth,
        db,
        onAuthStateChanged,
      };
      window.__firebaseInitialized = true;
    </script>

    <script src="./script.js"></script>
    <script>
      // ì–´ë“œë¯¼ í˜ì´ì§€ ì „ìš© ì´ˆê¸°í™”
      const ADMIN_EMAIL = 'jjiyu244@gmail.com';
      let currentUser = null;
      let isAdmin = false;
      let auth, db;

      const $ = (selector) => document.querySelector(selector);

      async function initAdmin() {
        if (!window.__firebase) {
          console.warn('Firebaseê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
          setTimeout(initAdmin, 100);
          return;
        }

        auth = window.__firebase.auth;
        db = window.__firebase.db;

        const { onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js');
        
        onAuthStateChanged(auth, async (user) => {
          if (user) {
            currentUser = { email: user.email, uid: user.uid };
            isAdmin = user.email === ADMIN_EMAIL;
            
            if (!isAdmin) {
              alert('ì–´ë“œë¯¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. í™ˆìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
              window.location.href = '/';
              return;
            }
            
            // ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ ë Œë”ë§
            await renderAdminPage();
            // ë¦¬ì›Œë“œ ìˆ˜ì • ëª¨ë‹¬ ì„¤ì • (script.jsì˜ í•¨ìˆ˜ ì‚¬ìš©)
            if (typeof setupRewardEditModal === 'function') {
              setupRewardEditModal();
            }
          } else {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. í™ˆìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
            window.location.href = '/';
          }
        });
      }

      // ì–´ë“œë¯¼ í˜ì´ì§€ ë Œë”ë§ (script.jsì˜ í•¨ìˆ˜ ì‚¬ìš©)
      async function renderAdminPage() {
        const container = $('#adminPageContent');
        if (!container) return;
        
        container.innerHTML = '<div class="card glass" style="padding: 40px; text-align: center;"><p style="color: #9ca3af; font-size: 16px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>';
        
        try {
          const users = await loadAllUserStakes();
          await renderAdminDashboardContent(users, container);
        } catch (error) {
          console.error('ì–´ë“œë¯¼ í˜ì´ì§€ ë Œë”ë§ ì¤‘ ì˜¤ë¥˜:', error);
          container.innerHTML = `<div class="card glass" style="padding: 40px; text-align: center;"><p style="color: #ef4444; font-size: 16px;">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</p></div>`;
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener('DOMContentLoaded', () => {
        initAdmin();
      });
    </script>
  </body>
</html>

