<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ - ì½”ì–´ìœ„ë¸Œ ìŠ¤í…Œì´í‚¹</title>
    <script>
      // Firebase Analytics IndexedDB ê²½ê³  í•„í„°ë§
      (function() {
        const originalError = console.error;
        const originalWarn = console.warn;
        
        const filterMessage = (args) => {
          const message = args.map(arg => {
            if (typeof arg === 'string') return arg;
            if (arg && typeof arg.toString === 'function') return arg.toString();
            return JSON.stringify(arg);
          }).join(' ');
          
          // Analytics IndexedDB ê²½ê³  í•„í„°ë§
          if (message.includes('Analytics') && 
              (message.includes('IndexedDB') || 
               message.includes('indexeddb-unavailable') ||
               message.includes('analytics/indexeddb-unavailable'))) {
            return true;
          }
          
          // Firestore ì¸ë±ìŠ¤ ì˜¤ë¥˜ í•„í„°ë§ (fallbackìœ¼ë¡œ ì²˜ë¦¬ë˜ë¯€ë¡œ ì—ëŸ¬ë¡œ í‘œì‹œí•˜ì§€ ì•ŠìŒ)
          if (message.includes('Firestore ë¦¬ì›Œë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨') &&
              message.includes('The query requires an index')) {
            return true;
          }
          
          return false;
        };
        
        console.error = function(...args) {
          if (filterMessage(args)) {
            return;
          }
          originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
          if (filterMessage(args)) {
            return;
          }
          originalWarn.apply(console, args);
        };
      })();
    </script>
    <link rel="stylesheet" href="./styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      .admin-container {
        min-height: 100vh;
        padding: 20px;
        background: radial-gradient(circle at top, #1e293b 0, #020617 55%, #000 100%);
      }
      .admin-header {
        background: linear-gradient(135deg, #0052CC 0%, #0047AB 100%);
        padding: 20px 40px;
        margin-bottom: 32px;
        border-radius: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .admin-header h1 {
        color: white;
        font-size: 24px;
        font-weight: 700;
        margin: 0;
      }
      .admin-content {
        max-width: 1400px;
        margin: 0 auto;
      }
      .back-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.2s;
      }
      .back-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="admin-container">
      <div class="admin-content">
        <!-- Admin Header -->
        <div class="admin-header">
          <h1>ğŸ” ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ</h1>
          <a href="/" class="back-btn">â† í™ˆìœ¼ë¡œ</a>
        </div>

        <!-- Admin Dashboard Content -->
        <div id="adminPageContent" style="width: 100%; min-height: 500px;">
          <div class="card glass" style="padding: 40px; text-align: center;">
            <p style="color: #9ca3af; font-size: 16px;">ì´ˆê¸°í™” ì¤‘...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-backdrop" id="loginModal">
      <div class="modal glass">
        <div class="modal-header">
          <h2 class="modal-title" id="loginModalTitle">ë¡œê·¸ì¸</h2>
          <button class="modal-close" id="loginCloseBtn">âœ•</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="loginEmail">ì•„ì´ë”” ë˜ëŠ” ì´ë©”ì¼ ì£¼ì†Œ</label>
            <input
              type="text"
              id="loginEmail"
              class="input"
              placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: jjiyu244)"
              autocomplete="off"
              pattern="[A-Za-z0-9_]+"
            />
          </div>
          <div class="form-group">
            <label for="loginPassword">ë¹„ë°€ë²ˆí˜¸</label>
            <input
              type="password"
              id="loginPassword"
              class="input"
              placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
              autocomplete="current-password"
            />
          </div>
          <button class="btn-primary w-full" id="loginConfirmBtn">ë¡œê·¸ì¸</button>
          <p id="loginStatusText" style="text-align:center;margin-top:16px;color:var(--text-muted);font-size:14px;"></p>
          <div style="text-align:center;margin-top:16px;display:none;">
            <button class="btn-outline" id="toSignup" style="font-size:14px;padding:8px 16px;display:none;">íšŒì›ê°€ì…</button>
            <button class="btn-outline" id="toLogin" style="font-size:14px;padding:8px 16px;display:none;">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
          </div>
          <p style="text-align:center;margin-top:16px;color:#9ca3af;font-size:12px;">ê´€ë¦¬ì ê³„ì •ë§Œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
      </div>
    </div>

    <!-- Reward Edit Modal -->
    <div class="modal-backdrop" id="rewardEditModal">
      <div class="modal glass" style="max-width: 500px;">
        <div class="modal-header">
          <h2 class="modal-title">ë¦¬ì›Œë“œ ë‚´ì—­ ìˆ˜ì •</h2>
          <button class="modal-close" id="rewardEditCloseBtn">âœ•</button>
        </div>
        <div class="modal-body">
          <div class="form-group" style="margin-bottom: 16px;">
            <label for="editRewardAmount" style="display:block;margin-bottom:8px;font-weight:600;color:var(--text);">ë¦¬ì›Œë“œ ìˆ˜ëŸ‰</label>
            <input
              type="number"
              id="editRewardAmount"
              class="input"
              placeholder="ì˜ˆ: 0.5"
              min="0"
              step="0.0001"
              style="width:100%;"
            />
          </div>
          <div class="form-group" style="margin-bottom: 16px;">
            <label for="editRewardApy" style="display:block;margin-bottom:8px;font-weight:600;color:var(--text);">APY (%)</label>
            <input
              type="number"
              id="editRewardApy"
              class="input"
              placeholder="ì˜ˆ: 8.5"
              min="0"
              step="0.1"
              style="width:100%;"
            />
          </div>
          <div class="form-group" style="margin-bottom: 24px;">
            <label for="editRewardDate" style="display:block;margin-bottom:8px;font-weight:600;color:var(--text);">ë‚ ì§œ</label>
            <input
              type="date"
              id="editRewardDate"
              class="input"
              style="width:100%;"
            />
          </div>
          <div style="display: flex; gap: 12px;">
            <button class="btn-primary" id="rewardUpdateBtn" style="flex: 1; padding: 12px;">ìˆ˜ì •</button>
            <button class="btn-outline" id="rewardDeleteBtn" style="flex: 1; padding: 12px; color: #ef4444; border-color: #ef4444;">ì‚­ì œ</button>
          </div>
          <p id="rewardEditStatusText" style="text-align:center;margin-top:16px;color:var(--text-muted);font-size:14px;"></p>
        </div>
      </div>
    </div>

    <!-- Firebase core (Auth/Firestore) ì´ˆê¸°í™” -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js';
      import {
        getAuth,
        onAuthStateChanged,
      } from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js';
      import {
        getFirestore,
      } from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js';

      const firebaseConfig = {
        apiKey: 'AIzaSyBvb8p8PFmeIh3ZVyWqWk1RQLBZyAUpfk4',
        authDomain: 'j22j22.firebaseapp.com',
        projectId: 'j22j22',
        storageBucket: 'j22j22.firebasestorage.app',
        messagingSenderId: '874202688810',
        appId: '1:874202688810:web:d384f6ea7cc4dcfb0b4253',
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      window.__firebase = {
        app,
        auth,
        db,
        onAuthStateChanged,
      };
      window.__firebaseInitialized = true;
    </script>

    <script src="./script.js"></script>
    <script>
      // ì–´ë“œë¯¼ í˜ì´ì§€ ì „ìš© ì´ˆê¸°í™”
      // ADMIN_EMAIL, currentUser, isAdmin, auth, db, $ëŠ” script.jsì—ì„œ ì´ë¯¸ ì „ì—­ìœ¼ë¡œ ì„ ì–¸ë¨
      // admin.htmlì—ì„œëŠ” window.__firebaseë¥¼ í†µí•´ ì ‘ê·¼

      async function initAdmin() {
        const container = $('#adminPageContent');
        
        if (!window.__firebase) {
          console.warn('Firebaseê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
          if (container) {
            container.innerHTML = `
              <div class="card glass" style="padding: 40px; text-align: center;">
                <p style="color: #9ca3af; font-size: 16px;">Firebase ì´ˆê¸°í™” ì¤‘...</p>
              </div>
            `;
          }
          setTimeout(initAdmin, 100);
          return;
        }

        // script.jsì˜ ì „ì—­ ë³€ìˆ˜ëŠ” ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ë¡œì»¬ ë³€ìˆ˜ ì‚¬ìš©
        const firebaseAuth = window.__firebase.auth;
        const firebaseDb = window.__firebase.db;
        
        // script.jsì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì „ì—­ìœ¼ë¡œ ì„¤ì •
        if (typeof window !== 'undefined') {
          window.db = firebaseDb;
          window.auth = firebaseAuth;
        }

        // ğŸ”¥ ì¤‘ë³µ onAuthStateChanged ë¦¬ìŠ¤ë„ˆ ì œê±°
        // script.jsì˜ initFirebaseì—ì„œ ì´ë¯¸ onAuthStateChangedë¥¼ ë“±ë¡í•˜ë¯€ë¡œ
        // admin.htmlì—ì„œëŠ” ë³„ë„ë¡œ ë“±ë¡í•˜ì§€ ì•ŠìŒ
        // ëŒ€ì‹  script.jsì˜ ì „ì—­ ë³€ìˆ˜ì™€ í•¨ìˆ˜ë¥¼ ì‚¬ìš©
        
        // ì¦‰ì‹œ í˜„ì¬ ì¸ì¦ ìƒíƒœ í™•ì¸
        const currentAuthUser = firebaseAuth.currentUser;
        console.log('ğŸ” [admin.html] í˜„ì¬ ì¸ì¦ ìƒíƒœ:', currentAuthUser ? currentAuthUser.email : 'ë¡œê·¸ì¸ ì•ˆ ë¨');
        
        // script.jsì˜ initFirebaseê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°
        // initFirebaseê°€ onAuthStateChangedë¥¼ ë“±ë¡í•˜ê³  ëŒ€ì‹œë³´ë“œë¥¼ ë Œë”ë§í•¨
        if (typeof initFirebase === 'function') {
          console.log('ğŸ” [admin.html] initFirebase í˜¸ì¶œ ëŒ€ê¸° ì¤‘...');
          await initFirebase();
          console.log('âœ… [admin.html] initFirebase ì™„ë£Œ');
        }
        
        // script.jsì˜ onAuthStateChangedê°€ ëŒ€ì‹œë³´ë“œë¥¼ ë Œë”ë§í•˜ë¯€ë¡œ
        // ì—¬ê¸°ì„œëŠ” ë³„ë„ë¡œ ë Œë”ë§í•˜ì§€ ì•ŠìŒ
        // ë‹¨, ì–´ë“œë¯¼ í˜ì´ì§€ ì „ìš© UI ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•˜ë©´ ì—¬ê¸°ì„œ ì²˜ë¦¬
        
        // ğŸ”¥ ë¡œë”© ìƒíƒœ íƒ€ì„ì•„ì›ƒ ì„¤ì • (5ì´ˆ í›„ ê°•ì œ í•´ì œ)
        let loadingTimeout = setTimeout(() => {
          console.warn('âš ï¸ [admin.html] ë¡œë”© íƒ€ì„ì•„ì›ƒ (5ì´ˆ) - ê°•ì œ í•´ì œ');
          if (container) {
            const loadingText = container.querySelector('p');
            if (loadingText && (loadingText.textContent.includes('ì´ˆê¸°í™” ì¤‘') || loadingText.textContent.includes('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘'))) {
              // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìƒíƒœì¸ì§€ í™•ì¸
              const currentAuthUser = firebaseAuth.currentUser;
              if (!currentAuthUser) {
                // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìƒíƒœë©´ ë¡œê·¸ì¸ í¼ í‘œì‹œ
                container.innerHTML = `
                  <div class="card glass" style="padding: 40px; text-align: center;">
                    <h3 style="color: #ffffff; font-size: 20px; margin-bottom: 16px;">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>
                    <p style="color: #9ca3af; font-size: 16px; margin-bottom: 24px;">ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œì— ì ‘ê·¼í•˜ë ¤ë©´ ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
                    <button class="btn-primary" id="showLoginBtnTimeout" style="padding: 12px 24px; font-size: 16px;">ë¡œê·¸ì¸í•˜ê¸°</button>
                  </div>
                `;
                
                const showLoginBtnTimeout = document.getElementById('showLoginBtnTimeout');
                if (showLoginBtnTimeout) {
                  showLoginBtnTimeout.addEventListener('click', () => {
                    const loginModal = document.getElementById('loginModal');
                    if (loginModal) {
                      loginModal.classList.add('show');
                    }
                  });
                }
                
                // ë¡œê·¸ì¸ ëª¨ë‹¬ ìë™ í‘œì‹œ
                setTimeout(() => {
                  const loginModal = document.getElementById('loginModal');
                  if (loginModal) {
                    loginModal.classList.add('show');
                  }
                }, 300);
              } else {
                // ë¡œê·¸ì¸í•œ ìƒíƒœë©´ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ë§Œ í‘œì‹œ
                container.innerHTML = `
                  <div class="card glass" style="padding: 40px; text-align: center;">
                    <h3 style="color: #ef4444; font-size: 20px; margin-bottom: 12px;">ë¡œë”© ì‹œê°„ ì´ˆê³¼</h3>
                    <p style="color: #fca5a5; font-size: 16px; margin-bottom: 8px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.</p>
                    <button class="btn-primary" onclick="location.reload()" style="margin-top: 20px; padding: 12px 24px;">ìƒˆë¡œê³ ì¹¨</button>
                  </div>
                `;
              }
            }
          }
        }, 5000);
        
        // script.jsì˜ onAuthStateChangedê°€ ëŒ€ì‹œë³´ë“œë¥¼ ë Œë”ë§í•˜ë©´ íƒ€ì„ì•„ì›ƒ ì·¨ì†Œ
        // (ëŒ€ì‹œë³´ë“œê°€ ë Œë”ë§ë˜ë©´ container.innerHTMLì´ ë³€ê²½ë˜ë¯€ë¡œ)
        const checkDashboardRendered = setInterval(() => {
          if (container) {
            const loadingText = container.querySelector('p');
            if (loadingText && !loadingText.textContent.includes('ì´ˆê¸°í™” ì¤‘') && !loadingText.textContent.includes('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘')) {
              clearTimeout(loadingTimeout);
              clearInterval(checkDashboardRendered);
              console.log('âœ… [admin.html] ëŒ€ì‹œë³´ë“œ ë Œë”ë§ ì™„ë£Œ, íƒ€ì„ì•„ì›ƒ ì·¨ì†Œ');
            }
          }
        }, 500);
      }


      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener('DOMContentLoaded', async () => {
        // ë¡œê·¸ì¸ UI ì„¤ì • (admin.htmlì—ì„œë„ ì‚¬ìš©)
        if (typeof setupLogin === 'function') {
          await setupLogin();
        }
        initAdmin();
      });
    </script>
  </body>
</html>

